let mob=[];const mobs={loop(){let t=mob.length;for(;t--;)mob[t].alive?mob[t].do():mob[t].replace(t)},draw(){},drawDefault(){ctx.lineWidth=2;let t=mob.length;for(;t--;){ctx.beginPath();const i=mob[t].vertices;ctx.moveTo(i[0].x,i[0].y);for(let t=1,e=i.length;t<e;++t)ctx.lineTo(i[t].x,i[t].y);ctx.lineTo(i[0].x,i[0].y),ctx.fillStyle=mob[t].fill,ctx.strokeStyle=mob[t].stroke,ctx.fill(),ctx.stroke()}},statusSlow(t,i=60){if(e(t),tech.isAoESlow){const i=(200+170*Math.random())**2;for(let s=0,o=mob.length;s<o;s++)t!==mob[s]&&Vector.magnitudeSquared(Vector.sub(t.position,mob[s].position))<i+mob[s].radius&&e(mob[s]);simulation.drawList.push({x:t.position.x,y:t.position.y,radius:Math.sqrt(i),color:"rgba(0,100,255,0.05)",time:simulation.drawTime})}function e(t){if(!t.shield&&!t.isShielded&&t.alive){tech.isIceMaxHealthLoss&&t.health>.66&&t.damageReduction>0&&(t.health=.66),tech.isIceKill&&t.health<.34&&t.damageReduction>0&&t.alive&&(t.damage(1/0),simulation.drawList.push({x:t.position.x,y:t.position.y,radius:1.2*t.radius,color:"rgb(0,100,255)",time:8}),simulation.drawList.push({x:t.position.x,y:t.position.y,radius:.7*t.radius,color:"rgb(0,100,255)",time:12}),simulation.drawList.push({x:t.position.x,y:t.position.y,radius:.4*t.radius,color:"rgb(0,100,255)",time:16})),t.isBoss&&(i=Math.floor(.25*i));let e=t.status.length;for(;e--;)"slow"===t.status[e].type&&t.status.splice(e,1);t.isSlowed=!0,t.status.push({effect(){if(t.speed>1){const i=.94;Matter.Body.setVelocity(t,{x:t.velocity.x*i,y:t.velocity.y*i})}Matter.Body.setAngularVelocity(t,0),ctx.beginPath(),ctx.moveTo(t.vertices[0].x,t.vertices[0].y);for(let i=1,e=t.vertices.length;i<e;++i)ctx.lineTo(t.vertices[i].x,t.vertices[i].y);ctx.lineTo(t.vertices[0].x,t.vertices[0].y),ctx.strokeStyle="rgba(0,100,255,0.8)",ctx.lineWidth=15,ctx.stroke(),ctx.fillStyle=t.fill,ctx.fill()},endEffect(){t.isSlowed=!1},type:"slow",endCycle:simulation.cycle+i})}}},statusStun(t,i=180){if(!t.shield&&!t.isShielded){t.speed>3&&Matter.Body.setVelocity(t,{x:.8*t.velocity.x,y:.8*t.velocity.y}),Matter.Body.setAngularVelocity(t,.8*t.angularVelocity);let e=t.status.length;for(;e--;)"stun"===t.status[e].type&&t.status.splice(e,1);t.isStunned=!0,t.status.push({effect(){t.memory!==1/0?(t.seePlayer.yes=!1,t.seePlayer.recall=0,t.seePlayer.position={x:t.position.x+100*(Math.random()-.5),y:t.position.y+100*(Math.random()-.5)}):Matter.Body.setVelocity(t,{x:.6*t.velocity.x,y:.6*t.velocity.y}),t.velocity.y<2&&(t.force.y+=4e-4*t.mass),ctx.fillStyle=`rgba(${Math.floor(255*Math.random())},${Math.floor(255*Math.random())},${Math.floor(255*Math.random())},0.5)`,ctx.beginPath(),ctx.moveTo(t.vertices[0].x,t.vertices[0].y);for(let i=1,e=t.vertices.length;i<e;++i)ctx.lineTo(t.vertices[i].x,t.vertices[i].y);ctx.lineTo(t.vertices[0].x,t.vertices[0].y),ctx.fill()},endEffect(){t.isStunned=!1},type:"stun",endCycle:simulation.cycle+i*(t.isBoss?.2:1)})}},statusDoT(t,i,e=180){!t.isShielded&&t.alive&&t.damageReduction>0&&t.status.push({effect(){if((simulation.cycle-this.startCycle)%30==0){let i=tech.radioactiveDamage*this.dmg;t.damage(i),t.damageReduction&&simulation.drawList.push({x:t.position.x+(Math.random()-.5)*t.radius*.5,y:t.position.y+(Math.random()-.5)*t.radius*.5,radius:40*Math.log(i+1.1)*t.damageReduction+3,color:"rgba(0,80,80,0.9)",time:simulation.drawTime})}},endEffect(){},dmg:i,type:"dot",endCycle:simulation.cycle+e,startCycle:simulation.cycle+29})},deathCount:0,mobSpawnWithHealth:1,setMobSpawnHealth(){mobs.mobSpawnWithHealth=.88**tech.mobSpawnWithHealth},spawn(t,i,e,s,o){let a=mob.length;mob[a]=Matter.Bodies.polygon(t,i,e,s,{mob:!0,density:.001,frictionAir:.005,restitution:.5,collisionFilter:{group:0,category:cat.mob,mask:cat.player|cat.map|cat.body|cat.bullet|cat.mob},onHit:void 0,alive:!0,index:a,health:mobs.mobSpawnWithHealth,accelMag:.001*simulation.accelScale,cd:0,delay:60,fill:o,stroke:"#000",seePlayer:{yes:!1,recall:0,position:{x:t,y:i}},radius:s,spawnPos:{x:t,y:i},healthBar1(){const t=.3*this.radius,i=2*this.radius,e=this.position.x-i/2,s=this.position.y-.7*i;ctx.fillStyle="rgba(100, 100, 100, 0.3)",ctx.fillRect(e,s,i,t),ctx.fillStyle="rgba(255,0,0,0.7)",ctx.fillRect(e,s,i*this.health,t)},healthBar2(){const t=this.position.x-this.radius,i=this.position.x+this.radius,e=this.position.y-this.radius;ctx.lineWidth=.27*this.radius,ctx.beginPath(),ctx.moveTo(t,e),ctx.lineTo(i,e),ctx.strokeStyle="rgba(100, 100, 100, 0.3)",ctx.stroke(),ctx.beginPath(),ctx.moveTo(t,e),ctx.lineTo(t+2*this.radius*this.health,e),ctx.strokeStyle="rgba(255, 0, 100, 0.8)",ctx.stroke()},healthBar3(){const t=1.5*Math.PI;ctx.lineWidth=.25*this.radius,ctx.strokeStyle=`rgb(${Math.floor(150+50*Math.random())},0,${Math.floor(150+50*Math.random())})`,ctx.beginPath(),ctx.arc(this.position.x,this.position.y,1.5*this.radius,t-this.health,t+this.health),ctx.stroke()},healthBar4(){const t=.43*this.radius,i=this.position.x-this.radius,e=this.position.y-1.4*this.radius;let s;ctx.fillStyle="rgba(100, 100, 100, 0.3)",ctx.fillRect(i,e,2*this.radius,t),this.health>.5?(ctx.fillStyle="#000",s=2*(this.health-.5)):(ctx.fillStyle="#fff",s=2*this.health);for(let o=0;o<4;o++)s>.25*o&&ctx.fillRect(i+.52*o*this.radius,e,t,t)},status:[],checkStatus(){let t=this.status.length;for(;t--;)this.status[t].effect(),this.status[t].endCycle<simulation.cycle&&(this.status[t].endEffect(),this.status.splice(t,1))},isSlowed:!1,isStunned:!1,seeAtDistance2:1/0,distanceToPlayer(){const t=this.position.x-player.position.x,i=this.position.y-player.position.y;return Math.sqrt(t*t+i*i)},distanceToPlayer2(){const t=this.position.x-player.position.x,i=this.position.y-player.position.y;return t*t+i*i},gravity(){this.force.y+=this.mass*this.g},seePlayerFreq:Math.floor(30+30*Math.random()),foundPlayer(){this.locatePlayer(),this.seePlayer.yes||(this.alertNearByMobs(),this.seePlayer.yes=!0)},lostPlayer(){this.seePlayer.yes=!1,this.seePlayer.recall-=this.seePlayerFreq,this.seePlayer.recall<0&&(this.seePlayer.recall=0)},memory:120,locatePlayer(){this.seePlayer.recall=this.memory+Math.round(this.memory*Math.random()),this.seePlayer.position.x=player.position.x,this.seePlayer.position.y=player.position.y},alertNearByMobs(){for(let t=0;t<mob.length;t++)!mob[t].seePlayer.recall&&Vector.magnitudeSquared(Vector.sub(this.position,mob[t].position))<this.alertRange2&&mob[t].locatePlayer()},alwaysSeePlayer(){m.isCloak||(this.seePlayer.recall=1,this.seePlayer.position.x=player.position.x,this.seePlayer.position.y=player.position.y)},seePlayerByHistory(t=30){if(!(simulation.cycle%this.seePlayerFreq))if(0!==Matter.Query.ray(map,this.position,this.playerPosRandomY()).length||m.isCloak){if(this.seePlayer.recall&&(this.lostPlayer(),!m.isCloak))for(let i=0;i<t;i++){let t=m.history[(simulation.cycle-10*i)%600];if(0===Matter.Query.ray(map,this.position,t.position).length){this.seePlayer.recall=this.memory+Math.round(this.memory*Math.random()),this.seePlayer.position.x=t.position.x,this.seePlayer.position.y=t.position.y,this.seePlayer.yes=!0;break}}}else this.foundPlayer()},seePlayerCheck(){simulation.cycle%this.seePlayerFreq||(this.distanceToPlayer2()<this.seeAtDistance2&&0===Matter.Query.ray(map,this.position,this.playerPosRandomY()).length&&!m.isCloak?this.foundPlayer():this.seePlayer.recall&&this.lostPlayer())},seePlayerCheckByDistance(){simulation.cycle%this.seePlayerFreq||(this.distanceToPlayer2()<this.seeAtDistance2&&!m.isCloak?this.foundPlayer():this.seePlayer.recall&&this.lostPlayer())},seePlayerByDistOrLOS(){simulation.cycle%this.seePlayerFreq||((this.distanceToPlayer2()<this.seeAtDistance2||0===Matter.Query.ray(map,this.position,this.playerPosRandomY()).length)&&!m.isCloak?this.foundPlayer():this.seePlayer.recall&&this.lostPlayer())},isLookingAtPlayer(t){const i=Vector.normalise(Vector.sub(player.position,this.position)),e={x:Math.cos(this.angle),y:Math.sin(this.angle)};return Vector.dot(e,i)>t},lookRange:.2+.2*Math.random(),lookTorque:4e-7*(Math.random()>.5?-1:1),seePlayerByLookingAt(){if(simulation.cycle%this.seePlayerFreq||!this.seePlayer.recall&&!this.isLookingAtPlayer(this.lookRange)||(this.distanceToPlayer2()<this.seeAtDistance2&&0===Matter.Query.ray(map,this.position,this.playerPosRandomY()).length&&!m.isCloak?this.foundPlayer():this.seePlayer.recall&&this.lostPlayer()),!this.seePlayer.recall){this.torque=this.lookTorque*this.inertia;const t=Math.PI*this.lookRange;ctx.beginPath(),ctx.arc(this.position.x,this.position.y,2.5*this.radius,this.angle-t,this.angle+t),ctx.arc(this.position.x,this.position.y,1.4*this.radius,this.angle+t,this.angle-t,!0),ctx.fillStyle="rgba(0,0,0,0.07)",ctx.fill()}},playerPosRandomY:()=>({x:player.position.x,y:player.position.y+110*(Math.random()-.5)}),harmZone(){this.seePlayer.yes&&(ctx.setLineDash([125*Math.random(),125*Math.random()]),this.distanceToPlayer()<this.laserRange&&(m.immuneCycle<m.cycle&&(m.takeDamage(3e-4*this.damageScale()),m.energy>.1&&(m.energy-=.003)),ctx.beginPath(),ctx.moveTo(this.position.x,this.position.y),ctx.lineTo(m.pos.x,m.pos.y),ctx.lineTo(m.pos.x+3e3*(Math.random()-.5),m.pos.y+3e3*(Math.random()-.5)),ctx.lineWidth=2,ctx.strokeStyle="rgb(255,0,170)",ctx.stroke(),ctx.beginPath(),ctx.arc(m.pos.x,m.pos.y,40,0,2*Math.PI),ctx.fillStyle="rgba(255,0,170,0.15)",ctx.fill()),ctx.beginPath(),ctx.arc(this.position.x,this.position.y,.9*this.laserRange,0,2*Math.PI),ctx.strokeStyle="rgba(255,0,170,0.5)",ctx.lineWidth=1,ctx.stroke(),ctx.setLineDash([]),ctx.fillStyle="rgba(255,0,170,0.03)",ctx.fill())},wing(t,i=250,e=.4,s=3e-4){const o=i*e,a={x:Math.cos(t),y:Math.sin(t)},l=Vector.add(this.position,Vector.mult(a,i+.8*this.radius));ctx.beginPath(),ctx.ellipse(l.x,l.y,i,o,t,0,2*Math.PI),ctx.fill();if(Matter.Query.ray([player],this.position,Vector.add(this.position,Vector.mult(a,2.05*i)),o).length&&m.immuneCycle<m.cycle){m.takeDamage(s*this.damageScale());const t=Vector.sub(m.pos,this.position),i=Vector.mult(Vector.normalise(t),.15*player.mass);Matter.Body.setVelocity(player,{x:.9*player.velocity.x+i.x,y:.9*player.velocity.y+i.y-.1*player.mass})}},searchSpring(){ctx.beginPath(),ctx.arc(this.cons.pointA.x,this.cons.pointA.y,6,0,2*Math.PI),ctx.arc(this.cons2.pointA.x,this.cons2.pointA.y,6,0,2*Math.PI),ctx.fillStyle="#222",ctx.fill(),simulation.cycle%this.seePlayerFreq||((this.seePlayer.recall||this.isLookingAtPlayer(this.lookRange))&&this.distanceToPlayer2()<this.seeAtDistance2&&0===Matter.Query.ray(map,this.position,player.position).length&&0===Matter.Query.ray(body,this.position,player.position).length&&!m.isCloak?this.foundPlayer():this.seePlayer.recall&&this.lostPlayer())},springAttack(){if(this.seePlayer.recall&&0===Matter.Query.ray(map,this.position,this.seePlayer.position).length)if(simulation.cycle%(2*this.seePlayerFreq)){if(!(simulation.cycle%this.seePlayerFreq)){const t=Vector.normalise(Vector.sub(this.seePlayer.position,this.position)),i=Vector.add(this.position,Vector.mult(t,600));this.springTarget2.x=i.x,this.springTarget2.y=i.y,this.cons.length=100+1.5*this.radius,this.cons2.length=-200}}else{const t=Vector.normalise(Vector.sub(this.seePlayer.position,this.position)),i=Vector.add(this.position,Vector.mult(t,600));this.springTarget.x=i.x,this.springTarget.y=i.y,this.cons.length=-200,this.cons2.length=100+1.5*this.radius}else{this.torque=this.lookTorque*this.inertia;const t=Math.PI*this.lookRange;if(ctx.beginPath(),ctx.arc(this.position.x,this.position.y,2.5*this.radius,this.angle-t,this.angle+t),ctx.arc(this.position.x,this.position.y,1.4*this.radius,this.angle+t,this.angle-t,!0),ctx.fillStyle="rgba(0,0,0,0.07)",ctx.fill(),!(simulation.cycle%(4*this.seePlayerFreq))){best={x:null,y:null,dist2:1/0,who:null,v1:null,v2:null};const t=3e3,i={x:this.position.x+t*Math.cos(this.angle),y:this.position.y+t*Math.sin(this.angle)};best=vertexCollision(this.position,i,[map,body]),best.dist2!=1/0&&(Math.random()>.5?(this.springTarget.x=best.x,this.springTarget.y=best.y,this.cons.length=100+1.5*this.radius,this.cons2.length=100+1.5*this.radius):(this.springTarget2.x=best.x,this.springTarget2.y=best.y,this.cons.length=100+1.5*this.radius,this.cons2.length=100+1.5*this.radius))}}},curl(t=1e3,i=-10){applyCurl=function(e,s,o=!0){for(let a=0;a<s.length;++a)if(!s[a].isNotHoldable){const l=Vector.sub(e,s[a].position),h=Vector.magnitudeSquared(l);if(h<t*t&&h>1e4){const t=Vector.mult(Vector.perp(Vector.normalise(l)),i);s[a].isMobBullet?Matter.Body.setVelocity(s[a],{x:.97*s[a].velocity.x+.06*t.x,y:.97*s[a].velocity.y+.06*t.y}):Matter.Body.setVelocity(s[a],{x:.95*s[a].velocity.x+.06*t.x,y:.95*s[a].velocity.y+.06*t.y}),o&&(s[a].force.y-=.8*simulation.g*s[a].mass)}}},applyCurl(this.position,mob,!1),applyCurl(this.position,body),applyCurl(this.position,powerUp)},pullPlayer(){if(this.seePlayer.yes&&Vector.magnitudeSquared(Vector.sub(this.position,player.position))<1e6){const t=Math.atan2(player.position.y-this.position.y,player.position.x-this.position.x);player.force.x-=.00113*simulation.accelScale*player.mass*Math.cos(t)*(m.onGround?2:1),player.force.y-=84e-5*simulation.accelScale*player.mass*Math.sin(t),ctx.beginPath(),ctx.moveTo(this.position.x,this.position.y),ctx.lineTo(m.pos.x,m.pos.y),ctx.lineWidth=Math.min(60,2*this.radius),ctx.strokeStyle="rgba(0,0,0,0.5)",ctx.stroke(),ctx.beginPath(),ctx.arc(m.pos.x,m.pos.y,40,0,2*Math.PI),ctx.fillStyle="rgba(0,0,0,0.3)",ctx.fill()}},repelBullets(){for(let t=0,i=bullet.length;t<i;++t){const i=bullet[t].position.x-this.position.x,e=bullet[t].position.y-this.position.y,s=Math.max(300,Math.sqrt(i*i+e*e));if(s<700){ctx.moveTo(this.position.x,this.position.y),ctx.lineTo(bullet[t].position.x,bullet[t].position.y);const o=Math.atan2(e,i),a=500*bullet[t].mass*simulation.g/s;bullet[t].force.x+=a*Math.cos(o),bullet[t].force.y+=a*Math.sin(o)}}},attraction(){if(this.seePlayer.recall){const t=Vector.mult(Vector.normalise(Vector.sub(this.seePlayer.position,this.position)),this.accelMag*this.mass);this.force.x+=t.x,this.force.y+=t.y}},repulsionRange:5e5,repulsion(){if(this.seePlayer.recall&&this.distanceToPlayer2()<this.repulsionRange){const t=this.accelMag*this.mass,i=Math.atan2(this.seePlayer.position.y-this.position.y,this.seePlayer.position.x-this.position.x);this.force.x-=2*t*Math.cos(i),this.force.y-=2*t*Math.sin(i)}},hoverOverPlayer(){if(this.seePlayer.recall){const t=250;this.position.y>this.seePlayer.position.y-this.hoverElevation+t?this.force.y-=this.accelMag*this.mass:this.position.y<this.seePlayer.position.y-this.hoverElevation-t&&(this.force.y+=this.accelMag*this.mass);const i=150;this.position.x>this.seePlayer.position.x+this.hoverXOff+i?this.force.x-=this.accelMag*this.mass:this.position.x<this.seePlayer.position.x+this.hoverXOff-i&&(this.force.x+=this.accelMag*this.mass)}},grow(){if(this.seePlayer.recall){if(this.radius<80){const t=1.01;Matter.Body.scale(this,t,t),this.radius*=t,this.fill=`hsl(144, ${this.radius}%, 50%)`,this.isShielded&&(this.isShielded=!1,this.removeConsBB())}}else if(this.radius>15){const t=.99;Matter.Body.scale(this,t,t),this.radius*=t,this.fill=`hsl(144, ${this.radius}%, 50%)`}},search(){if(!this.seePlayer.recall){const t=function(t){Math.random()<7e-4?t.searchTarget=player.position:t.searchTarget=map[Math.floor(Math.random()*(map.length-1))].position},i=Vector.sub(this.searchTarget,this.position);Vector.magnitude(i)>2*this.radius?this.force=Vector.mult(Vector.normalise(i),this.accelMag*this.mass*.2):t(this),simulation.cycle%(15*this.seePlayerFreq)||t(this)}},blink(){if(this.seePlayer.recall&&!(simulation.cycle%this.blinkRate)){ctx.beginPath(),ctx.moveTo(this.position.x,this.position.y);const t=Vector.sub(this.seePlayer.position,this.position),i=Vector.magnitude(t),e=Vector.normalise(t),o=50*(Math.random()-.5);i<this.blinkLength?Matter.Body.translate(this,Vector.mult(e,i+o)):Matter.Body.translate(this,Vector.mult(e,this.blinkLength+o)),ctx.lineTo(this.position.x,this.position.y),ctx.lineWidth=2*s,ctx.strokeStyle=this.stroke,ctx.stroke()}},drift(){if(this.seePlayer.recall&&!(simulation.cycle%this.blinkRate)){ctx.beginPath(),ctx.moveTo(this.position.x,this.position.y);const t=Vector.sub(this.seePlayer.position,this.position),i=Vector.magnitude(t),e=Vector.mult(Vector.normalise(t),this.blinkLength);i<this.blinkLength?(Matter.Body.setPosition(this,this.seePlayer.position),Matter.Body.translate(this,{x:50*(Math.random()-.5),y:50*(Math.random()-.5)})):(e.x+=200*(Math.random()-.5),e.y+=200*(Math.random()-.5),Matter.Body.translate(this,e)),ctx.lineTo(this.position.x,this.position.y),ctx.lineWidth=2*s,ctx.strokeStyle=this.stroke,ctx.stroke()}},bomb(){!(simulation.cycle%this.fireFreq)&&Math.abs(this.position.x-this.seePlayer.position.x)<400&&0===Matter.Query.ray(map,this.position,this.playerPosRandomY()).length&&0===Matter.Query.ray(body,this.position,this.playerPosRandomY()).length&&(spawn.bomb(this.position.x,this.position.y+.7*this.radius,9+Math.ceil(this.radius/15),5),Matter.Body.setAngularVelocity(mob[mob.length-1],.5*(Math.random()-.5)),Matter.Body.setVelocity(mob[mob.length-1],{x:this.velocity.x,y:this.velocity.y}),Matter.Body.setAngularVelocity(this,.25*(Math.random()-.5)))},fire(){const t=()=>{const t=this.radius+this.radius*this.noseLength;this.vertices[1].x=this.position.x+Math.cos(this.angle)*t,this.vertices[1].y=this.position.y+Math.sin(this.angle)*t};if(this.seePlayer.recall){simulation.cycle%this.seePlayerFreq||(this.fireDir=Vector.normalise(Vector.sub(this.seePlayer.position,this.position)),this.fireDir.y-=Math.abs(this.seePlayer.position.x-this.position.x)/2500);const i=this.angle+Math.PI/2,e=Vector.dot({x:Math.cos(i),y:Math.sin(i)},this.fireDir),s=.1;if(e>s)this.torque+=4e-6*this.inertia;else if(e<-s)this.torque-=4e-6*this.inertia;else if(this.noseLength>1.5&&e>-.2&&e<.2){spawn.bullet(this.vertices[1].x,this.vertices[1].y,this.tier,9+Math.ceil(this.radius/15));const t=15;Matter.Body.setVelocity(mob[mob.length-1],{x:this.velocity.x+this.fireDir.x*t+3*Math.random(),y:this.velocity.y+this.fireDir.y*t+3*Math.random()}),this.noseLength=0,this.force.x-=.005*this.fireDir.x*this.mass,this.force.y-=.005*this.fireDir.y*this.mass}this.noseLength<1.5&&(this.noseLength+=this.fireFreq),t()}else this.noseLength>.1&&(this.noseLength-=this.fireFreq/2,t())},turnToFacePlayer(){const t=player.position.x-this.position.x,i=-player.position.y+this.position.y,e=this.distanceToPlayer(),s=this.angle+Math.PI/2;c=Math.cos(s)*t-Math.sin(s)*i,c>.04*e?this.torque+=.002*this.mass:c<.04&&(this.torque-=.002*this.mass)},facePlayer(){const t=Vector.normalise(Vector.sub(this.seePlayer.position,this.position)),i=Math.atan2(t.y,t.x);Matter.Body.setAngle(this,i-Math.PI)},explode(t=this.mass){m.immuneCycle<m.cycle&&(m.takeDamage(Math.min(Math.max(.03*Math.sqrt(t),.01),.4)*this.damageScale()),this.isDropPowerUp=!1,this.death())},timeLimit(){this.timeLeft--,this.timeLeft<0&&(this.isDropPowerUp=!1,this.death())},damageScale(){return spawn.mobDmgDoneByTier[this.tier]&&level.levelsCleared<14?spawn.mobDmgDoneByTier[this.tier]:spawn.dmgToPlayerByLevelsCleared()},damage(t,i=!1){if((!this.isShielded||i)&&this.alive){if(t!==1/0){if(t*=tech.damageAdjustments(),this.isDropPowerUp)if(1===this.health){if(tech.isMobFullHealthCloak&&(t*=2.11,simulation.ephemera.push({count:7,vertices:this.vertices,do(){this.count--,this.count<0&&simulation.removeEphemera(this),ctx.beginPath();const t=this.vertices;ctx.moveTo(t[0].x,t[0].y);for(let i=1,e=t.length;i<e;++i)ctx.lineTo(t[i].x,t[i].y);ctx.lineTo(t[0].x,t[0].y),ctx.fillStyle="rgba(255,0,100,0.15)",ctx.fill(),ctx.lineWidth=3,ctx.strokeStyle="#f08",ctx.stroke()}})),tech.isChatter&&!this.isInvulnerable){let t=!1;for(let i=0;i<simulation.ephemera.length;i++)"in game text"===simulation.ephemera[i].name&&(t=!0);if(!t){const t=["I can do *anything!*","Chaos, chaos!","Let's make the devilskn-","Darmok and Jaled at Tanagra","Kiazi's children, their faces wet!","Sokath with his eyes uncovered!","Are you suggesting that coconuts can migrate?","One, Two, Five!","Is it an African swallow or a European swallow?","kept you waiting, huh?","This prison... to hold... me?","Did everyone see that? Because I will not be doing it again","I see the light... it's a [404 Error]!","I wish i took those digeridoo lessons","Your mother was a hamster, and your father smelt of elderberries","In Rod we trust","AAAAAAAA","the devil may cry?","hey Mr M? are you still mad at me?"],i=`#${Math.floor(76*Math.random()+180).toString(16)}${Math.floor(121*Math.random()).toString(16).padStart(2,"0")}${Math.floor(121*Math.random()).toString(16).padStart(2,"0")}`,e=t[Math.floor(Math.random()*t.length)];level.inGameText(this.position.x,this.position.y-50,e,240,i)}}}else tech.isMobLowHealth&&this.health<.25&&(t*=3,simulation.ephemera.push({count:2,vertices:this.vertices,do(){this.count--,this.count<0&&simulation.removeEphemera(this),ctx.beginPath();const t=this.vertices;ctx.moveTo(t[0].x,t[0].y);for(let i=1,e=t.length;i<e;++i)ctx.lineTo(t[i].x,t[i].y);ctx.lineTo(t[0].x,t[0].y),ctx.fillStyle="rgba(255,50,100,0.2)",ctx.fill(),ctx.lineWidth=3,ctx.strokeStyle="#f38",ctx.stroke()}}));if(this.tier&&level.levelsCleared<14?t*=spawn.mobDmgTakenByTier[this.tier]:t*=spawn.mobDmgTakenByLevelsCleared(),t*=this.damageReduction,tech.isFarAwayDmg&&(t*=1+.0067*Math.sqrt(Math.max(500,Math.min(3e3,this.distanceToPlayer()))-500)),tech.energySiphon&&this.isDropPowerUp&&m.immuneCycle<m.cycle){const i=Math.min(this.health,t)*tech.energySiphon*level.isReducedRegen;isNaN(i)||i===1/0||(m.energy+=i)}t/=Math.sqrt(this.mass)}this.health-=t,this.onDamage(t),(this.health<.01||isNaN(this.health))&&this.alive&&this.death()}},onDamage(){},onDeath(){},damageReduction:1,leaveBody:!0,maxMobBody:40,isDropPowerUp:!0,death(){if(tech.collidePowerUps&&this.isDropPowerUp&&powerUps.randomize(this.position),this.onDeath(this),this.removeConsBB(),this.alive=!1,this.isDropPowerUp){if(level.isMobDeathHeal)for(let t=0;t<mob.length;t++)Vector.magnitudeSquared(Vector.sub(this.position,mob[t].position))<5e5&&mob[t].alive&&mob[t].health<1&&(mob[t].health+=.33,mob[t].health>1&&(mob[t].health=1),simulation.drawList.push({x:mob[t].position.x,y:mob[t].position.y,radius:mob[t].radius+20,color:"rgba(0,255,100,0.5)",time:10}));if(this.isSoonZombie){this.leaveBody=!1;let t=5,i=()=>{t>0?(m.alive&&requestAnimationFrame(i),simulation.paused||simulation.isChoosing||t--):spawn.zombie(this.position.x,this.position.y,this.radius,this.vertices.length,this.fill)};requestAnimationFrame(i)}if(tech.iceIXOnDeath&&this.isSlowed)for(let t=0,i=2*Math.sqrt(Math.min(this.mass,25))*tech.iceIXOnDeath;t<i;t++)b.iceIX(3,2*Math.random()*Math.PI,this.position);if(tech.deathSpawnsFromBoss||tech.deathSpawns){const t=tech.deathSpawns+tech.deathSpawnsFromBoss,i=Math.min(12,t*Math.ceil(Math.random()*simulation.difficulty*t));for(let t=0;t<i;t++)spawn.spawns(this.position.x+(Math.random()-.5)*s*2.5,this.position.y+(Math.random()-.5)*s*2.5,2),Matter.Body.setVelocity(mob[mob.length-1],{x:this.velocity.x+10*(Math.random()-.5),y:this.velocity.x+10*(Math.random()-.5)})}if(level.isMobRespawn&&!this.isBoss&&.25>Math.random()&&(simulation.drawList.push({x:this.position.x,y:this.position.y,radius:30,color:"#fff",time:20}),simulation.drawList.push({x:this.position.x,y:this.position.y,radius:20,color:"#fff",time:40}),simulation.drawList.push({x:this.position.x,y:this.position.y,radius:10,color:"#fff",time:60}),setTimeout(()=>{spawn.randomMobByLevelsCleared(this.position.x,this.position.y)},1e3)),tech.healSpawn&&Math.random()<tech.healSpawn&&(powerUps.spawn(this.position.x+20*(Math.random()-.5),this.position.y+20*(Math.random()-.5),"heal"),simulation.drawList.push({x:this.position.x,y:this.position.y,radius:50,color:"#0eb",time:12}),simulation.drawList.push({x:this.position.x,y:this.position.y,radius:100,color:"#0eb",time:6}),simulation.drawList.push({x:this.position.x,y:this.position.y,radius:200,color:"#0eb",time:3})),tech.isVerlet&&!m.isTimeDilated&&requestAnimationFrame(()=>{simulation.timePlayerSkip(this.isBoss?60:30),simulation.loop()}),tech.isEnergyLoss&&(m.energy-=.05,m.energy<0&&(m.energy=0)),tech.isRemineralize){const t=(simulation.cycle-tech.mineralLastCheck)/60;tech.mineralLastCheck=simulation.cycle,tech.mineralDamageReduction=1-(1-tech.mineralDamageReduction)*Math.pow(.9,t),tech.mineralDamage=1+(tech.mineralDamage-1)*Math.pow(.9,t),tech.mineralDamageReduction*=.85}if(tech.isDemineralize){const t=(simulation.cycle-tech.mineralLastCheck)/60;tech.mineralLastCheck=simulation.cycle,tech.mineralDamageReduction=1-(1-tech.mineralDamageReduction)*Math.pow(.9,t),tech.mineralDamage=1+(tech.mineralDamage-1)*Math.pow(.9,t),tech.mineralDamage*=1.08}if(powerUps.spawnRandomPowerUp(this.position.x,this.position.y),m.lastKillCycle=m.cycle,mobs.mobDeaths++,Math.random()<tech.sporesOnDeath){const t=Math.min(25,Math.floor(2+this.mass*(.5+.5*Math.random())));if(tech.isSporeFlea){const i=t/2;for(let t=0;t<i;t++){const t=10+5*Math.random(),i=2*Math.PI*Math.random();b.flea(this.position,{x:t*Math.cos(i),y:t*Math.sin(i)})}}else if(tech.isSporeWorm){const i=t/2;for(let t=0;t<i;t++)b.worm(this.position)}else for(let i=0;i<t;i++)b.spore(this.position)}if(tech.isExplodeMob&&b.explosion(this.position,Math.min(700,Math.sqrt(this.mass+6)*(30+60*Math.random()))),tech.nailsDeathMob&&b.targetedNail(this.position,tech.nailsDeathMob,39+6*Math.random()),tech.isBotSpawnerReset)for(let t=0,i=bullet.length;t<i;t++)bullet[t].botType&&bullet[t].endCycle!==1/0&&(bullet[t].endCycle=simulation.cycle+900);if(Math.random()<tech.botSpawner&&(b.randomBot(this.position,!1),bullet[bullet.length-1].endCycle=simulation.cycle+900,this.leaveBody=!1),tech.isMobDeathImmunity){const t=300;m.immuneCycle<m.cycle+t&&(m.immuneCycle=m.cycle+t)}if(tech.isAddRemoveMaxHealth&&!this.isBoss){const t=.0025;tech.isEnergyHealth?m.maxEnergy>t&&(tech.healMaxEnergyBonus-=t,m.setMaxEnergy()):m.maxHealth>t&&(tech.extraMaxHealth-=t,m.setMaxHealth())}tech.cloakDuplication&&!this.isBoss&&(tech.cloakDuplication-=.01,powerUps.setPowerUpMode())}else if(tech.isShieldAmmo&&this.shield&&1===this.shieldCount){let t="ammo";Math.random()<.4?t="heal":Math.random()<.3&&!tech.isSuperDeterminism&&(t="research");for(let i=0,e=Math.ceil(2*Math.random());i<e;i++)powerUps.spawn(this.position.x,this.position.y,t)}if(tech.isRadioactive){let t=0;for(let i=0,e=this.status.length;i<e;i++)"dot"===this.status[i].type&&(t+=this.status[i].dmg*(this.status[i].endCycle-simulation.cycle));if(t>0){let i=500,e=null;for(let t=0,s=mob.length;t<s;++t){const s=Vector.magnitude(Vector.sub(this.position,mob[t].position));mob[t].alive&&!mob[t].isShielded&&s<i&&(i=s,e=t)}e&&(mobs.statusDoT(mob[e],t/180,180),ctx.beginPath(),ctx.moveTo(this.position.x,this.position.y),ctx.lineTo(mob[e].position.x,mob[e].position.y),ctx.lineWidth=this.radius,ctx.strokeStyle="rgba(0,80,80,1)",ctx.stroke())}}},removeConsBB(){for(let t=0,i=consBB.length;t<i;++t){if(consBB[t].bodyA===this){consBB[t].bodyB.shield&&(consBB[t].bodyB.do=function(){this.death()}),consBB[t].bodyA=consBB[t].bodyB,consBB.splice(t,1),this.removeConsBB();break}if(consBB[t].bodyB===this){consBB[t].bodyA.shield&&(consBB[t].bodyA.do=function(){this.death()}),consBB[t].bodyB=consBB[t].bodyA,consBB.splice(t,1),this.removeConsBB();break}}},removeCons(){for(let t=0,i=cons.length;t<i;++t){if(cons[t].bodyA===this){cons[t].bodyA=cons[t].bodyB,cons.splice(t,1),this.removeCons();break}if(cons[t].bodyB===this){cons[t].bodyB=cons[t].bodyA,cons.splice(t,1),this.removeCons();break}}},replace(t){if(this.leaveBody&&body.length<mobs.maxMobBody&&this.mass<200&&this.mass>1&&this.radius>18){let i=Matter.Vertices.hull(Matter.Vertices.clockwiseSort(this.vertices));if(i.length>5&&body.length<35&&Math.random()<.25){const t=3+Math.floor((i.length-6)*Math.random()),e=i.slice(0,t+1);i=i.slice(t-1);const s=body.length;body[s]=Matter.Bodies.fromVertices(this.position.x,this.position.y,e),Matter.Body.setVelocity(body[s],Vector.mult(this.velocity,.5)),Matter.Body.setAngularVelocity(body[s],this.angularVelocity),body[s].collisionFilter.category=cat.body,body[s].collisionFilter.mask=cat.player|cat.map|cat.body|cat.bullet|cat.mob|cat.mobBullet,body[s].classType="body",body[s].frictionAir=.001,body[s].friction=.05,Composite.add(engine.world,body[s]);const o=body.length;if(body[o]=Matter.Bodies.fromVertices(this.position.x,this.position.y,i),Matter.Body.setVelocity(body[o],Vector.mult(this.velocity,.5)),Matter.Body.setAngularVelocity(body[o],this.angularVelocity),body[o].collisionFilter.category=cat.body,body[o].collisionFilter.mask=cat.player|cat.map|cat.body|cat.bullet|cat.mob|cat.mobBullet,body[o].classType="body",body[o].frictionAir=.001,body[o].friction=.05,Composite.add(engine.world,body[o]),body[s].mass+body[o].mass>16){const t=8+6*Math.random(),i=function(e,s){if(e.mass+s.mass>t){const t=.95;Matter.Body.scale(e,t,t),Matter.Body.scale(s,t,t),setTimeout(i,20,e,s)}};i(body[s],body[o])}}else{const t=body.length;if(body[t]=Matter.Bodies.fromVertices(this.position.x,this.position.y,i),Matter.Body.setVelocity(body[t],Vector.mult(this.velocity,.5)),Matter.Body.setAngularVelocity(body[t],this.angularVelocity),body[t].collisionFilter.category=cat.body,body[t].collisionFilter.mask=cat.player|cat.map|cat.body|cat.bullet|cat.mob|cat.mobBullet,body[t].classType="body",body[t].frictionAir=.001,body[t].friction=.05,Composite.add(engine.world,body[t]),body[t].mass>9){const i=7+4*Math.random(),e=function(t){if(t.mass>i){const i=.95;Matter.Body.scale(t,i,i),setTimeout(e,20,t)}};e(body[t])}}if(Matter.Composite.remove(engine.world,this),mob.splice(t,1),tech.isMobBlockFling){const t=body[body.length-1];t.isNotHoldable||(b.targetedBlock(t),Matter.Body.setAngularVelocity(t,(.5+.2*Math.random())*(Math.random()<.5?-1:1)))}}else Matter.Composite.remove(engine.world,this),mob.splice(t,1)}}),mob[a].alertRange2=Math.pow(3*mob[a].radius+550,2),Composite.add(engine.world,mob[a])}};